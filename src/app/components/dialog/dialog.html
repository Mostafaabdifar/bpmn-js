<h2 mat-dialog-title>{{ data.typeAction }}</h2>

@if(!openAddConditionDialog){
<mat-dialog-content>
  @if (data.typeAction === "StartEvent") {
  <form [formGroup]="startForm">
    <mat-form-field class="w-full">
      <mat-label>Name</mat-label>
      <input
        type="text"
        matInput
        formControlName="name"
        placeholder="Event Name"
      />
      @if (startForm.get('name')?.hasError('required')) {
      <mat-error>name is <strong>required</strong></mat-error>
      }
    </mat-form-field>

    <mat-form-field class="w-full">
      <mat-label>Description</mat-label>
      <textarea matInput formControlName="description"></textarea>
    </mat-form-field>
  </form>
  } @else if (data.typeAction === "Task") {
  <form [formGroup]="apiForm">
    <mat-form-field class="w-full">
      <mat-label>Name</mat-label>
      <input
        type="text"
        matInput
        formControlName="name"
        placeholder="Condition Name"
      />
      @if (apiForm.get('name')?.hasError('required')) {
      <mat-error>Name is <strong>required</strong></mat-error>
      }
    </mat-form-field>
    <mat-form-field class="w-full">
      <mat-label>Base Url</mat-label>
      <input
        type="text"
        matInput
        formControlName="baseUrl"
        placeholder="Base Url"
      />
      @if (apiForm.get('conditionLabel')?.hasError('required')) {
      <mat-error>Base Url is <strong>required</strong></mat-error>
      }
    </mat-form-field>
    <mat-form-field class="w-full">
      <mat-label>Path</mat-label>
      <input type="text" matInput formControlName="path" placeholder="Path" />
      @if (apiForm.get('conditionLabel')?.hasError('required')) {
      <mat-error>Path is <strong>required</strong></mat-error>
      }
    </mat-form-field>
    <mat-form-field class="w-full">
      <mat-label>Http Method Type</mat-label>
      <mat-select formControlName="httpMethodType">
        @for (item of HttpMethodTypes; track item) {
        <mat-option [value]="item.value">{{ item.title }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
    <mat-form-field class="w-full">
      <mat-label>Timeout</mat-label>
      <input
        type="number"
        matInput
        formControlName="timeout"
        placeholder="Timeout"
      />
      @if (apiForm.get('conditionLabel')?.hasError('required')) {
      <mat-error>Timeout is <strong>required</strong></mat-error>
      }
    </mat-form-field>
    <mat-form-field class="w-full">
      <mat-label>Query</mat-label>
      <input type="text" matInput formControlName="query" placeholder="Query" />
      @if (apiForm.get('conditionLabel')?.hasError('required')) {
      <mat-error>Query is <strong>required</strong></mat-error>
      }
    </mat-form-field>
    <mat-form-field class="w-full">
      <mat-label>Body</mat-label>
      <textarea
        matInput
        formControlName="body"
        rows="6"
        placeholder="Enter JSON"
      ></textarea>
      @if (apiForm.get('body')?.hasError('required')) {
      <mat-error>Body is <strong>required</strong></mat-error>
      }
    </mat-form-field>

    <div class="json-viewer">
      <pre [innerHTML]="apiForm.get('body')?.value | jsonPretty"></pre>
    </div>

    <mat-form-field class="w-full">
      <mat-label>Auth Http Type</mat-label>
      <mat-select formControlName="authHttpType">
        @for (item of AuthHttpTypes; track item) {
        <mat-option [value]="item.value">{{ item.title }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
    <mat-form-field class="w-full">
      <mat-label>Auth Http Value</mat-label>
      <input
        type="text"
        matInput
        formControlName="authHttpValue"
        placeholder="Auth Http Value"
      />
      @if (apiForm.get('conditionLabel')?.hasError('required')) {
      <mat-error>Auth Http Value is <strong>required</strong></mat-error>
      }
    </mat-form-field>
    <mat-form-field class="w-full">
      <mat-label>Http Headers</mat-label>
      <input
        type="text"
        matInput
        formControlName="httpHeaders"
        placeholder="Http Headers"
      />
      @if (apiForm.get('conditionLabel')?.hasError('required')) {
      <mat-error>Http Headers is <strong>required</strong></mat-error>
      }
    </mat-form-field>
  </form>
  } @else if (data.typeAction === "ExclusiveGateway") {

  <form [formGroup]="conditionForm">
    <mat-form-field class="w-full">
      <mat-label>Name</mat-label>
      <input type="text" matInput formControlName="name" placeholder="name" />
      @if (conditionForm.get('name')?.hasError('required')) {
      <mat-error>name is <strong>required</strong></mat-error>
      }
    </mat-form-field>

    <mat-form-field class="w-full">
      <mat-label>افزودن Resolver</mat-label>
      <mat-select formControlName="conditionResolverType">
        @for (item of ConditionResolverTypes; track item) {
        <mat-option [value]="item.value">{{ item.title }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    @if(showConditionForm){ @if(conditionValue !== 0){
    <mat-form-field class="w-full">
      <mat-label>پیام</mat-label>
      <mat-select formControlName="templateMessageItem">
        @for (item of templateMessageList; track item) {
        <mat-option [value]="item">{{ item.name }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
    }

    <mat-form-field class="w-full">
      <mat-label>کد http status ورودی مورد انتظار</mat-label>
      <mat-select
        formControlName="statusItemList"
        placeholder="وضعیت را انتخاب کنید"
        multiple
      >
        @for (item of statusList; track item) {
        <mat-option [value]="item">{{ item }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field class="w-full">
      <mat-label>رنج وضعیت‌ از</mat-label>
      <mat-select
        formControlName="statusRangeFrom"
        placeholder="لطفا یک وضعیت را انتخاب کنید"
      >
        @for (item of statusList; track item) {
        <mat-option [value]="item">{{ item }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field class="w-full">
      <mat-label>رنج وضعیت‌ تا</mat-label>
      <mat-select
        formControlName="statusRangeTo"
        placeholder="لطفا یک وضعیت را انتخاب کنید"
      >
        @for (item of statusList; track item) {
        <mat-option [value]="item">{{ item }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field class="w-full">
      <mat-label>وضعیت ها</mat-label>
      <mat-select
        formControlName="statusItem"
        placeholder="لطفا یک وضعیت را انتخاب کنید"
      >
        @for (item of statusList; track item) {
        <mat-option [value]="item">{{ item }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field class="w-full">
      <mat-label>نام وضعیت</mat-label>
      <input
        type="text"
        matInput
        formControlName="statusName"
        placeholder="نام وضعیت"
      />
      @if (conditionForm.get('statusName')?.hasError('required')) {
      <mat-error>Status name is <strong>required</strong></mat-error>
      }
    </mat-form-field>

    @if(conditionValue === 1){
    <mat-form-field class="w-full">
      <mat-label>Condition Relationship</mat-label>
      <mat-select formControlName="conditionRelationship">
        @for (item of ConditionRelationshipTypes; track item) {
        <mat-option [value]="item.value">{{ item.title }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <div class="condition-list">
      @for (item of conditions; track $index) {
      <div class="condition-item">
        <div class="condition-info">
          <div>
            Value: <span> {{ item.value }}</span>
          </div>
          <div>
            Condition Type:
            <span>{{ getConditionTypeName(item.conditionOperator) }}</span>
          </div>
          <div class="col-3">
            Feature Name: <span>{{ item.property }}</span>
          </div>
        </div>
        <div class="condition-action">
          <button
            (click)="onDeleteConditionClick($index)"
            matMiniFab
            aria-label="Example icon button with a delete icon"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
      }
    </div>

    <div class="mt-2">
      <button
        matButton
        (click)="openAddConditionDialog = true"
        [disabled]="!templateMessage"
      >
        Add condition
      </button>
    </div>

    } @if (conditionValue === 2 && templateMessageJson) {
    <hr />
    <div class="row">
      <div class="col-12">
        <app-select-json-tree
          [data]="templateMessageJson"
          (selectKey)="selectKey($event)"
        ></app-select-json-tree>
      </div>
    </div>
    @if (selectedKey) {
    <div class="row">
      <div class="col-6">
        <mat-form-field class="w-full">
          <mat-label>مقادیر مورد انتظار</mat-label>

          <mat-chip-grid #chipGrid formArrayName="values">
            @for (keyword of valuesArray.controls; track $index) {
            <mat-chip-row (removed)="removeKeyword(keyword.value)">
              {{ keyword.value }}
              <button
                matChipRemove
                [attr.aria-label]="'remove ' + keyword.value"
              >
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip-row>
            }
          </mat-chip-grid>

          <input
            [matChipInputFor]="chipGrid"
            placeholder="مقدار را وارد کنید"
            (matChipInputTokenEnd)="add($event)"
          />
        </mat-form-field>
      </div>

      <div class="col-6">
        <div class="d-flex justify-content-between w-100 inputSwitch-container">
          <p>
            <mat-slide-toggle formControlName="expected"
              >مورد انتظار</mat-slide-toggle
            >
          </p>
        </div>
      </div>
    </div>
    } } }
  </form>

  } @else if (data.typeAction === "EndEvent" || data.typeAction ===
  "CustomEndEvent") {
  <form [formGroup]="completeForm">
    <mat-form-field class="w-full">
      <mat-label>Name</mat-label>
      <input type="text" matInput formControlName="name" placeholder="name" />
      @if (apiForm.get('name')?.hasError('required')) {
      <mat-error>name is <strong>required</strong></mat-error>
      }
    </mat-form-field>

    <mat-form-field class="w-full">
      <mat-label>Description</mat-label>
      <textarea matInput formControlName="description"></textarea>
    </mat-form-field>
  </form>
  } @else if (data.typeAction === "CustomTask") {
  <form [formGroup]="mapperForm">
    <mat-form-field class="w-full">
      <mat-label>Name</mat-label>
      <input type="text" matInput formControlName="name" placeholder="name" />
      @if (apiForm.get('name')?.hasError('required')) {
      <mat-error>name is <strong>required</strong></mat-error>
      }
    </mat-form-field>
    <mat-form-field class="w-full">
      <mat-label>Message Mapping</mat-label>
      <input
        type="text"
        matInput
        formControlName="messageMapping"
        placeholder="message"
      />
      @if (apiForm.get('name')?.hasError('required')) {
      <mat-error>Message mapping is <strong>required</strong></mat-error>
      }
    </mat-form-field>

    <mat-form-field class="w-full">
      <mat-label>Description</mat-label>
      <textarea matInput formControlName="description"></textarea>
    </mat-form-field>
  </form>
  }
</mat-dialog-content>
<mat-dialog-actions>
  <button
    matButton
    [disabled]="
      startForm.invalid &&
      apiForm.invalid &&
      completeForm.invalid &&
      mapperForm.invalid &&
      conditionForm.invalid
    "
    (click)="onOkClick()"
  >
    Ok
  </button>
  <button matButton mat-dialog-close>Cancel</button>
</mat-dialog-actions>

} @else {
<app-add-condition
  [visible]="openAddConditionDialog"
  (hideDialog)="openAddConditionDialog = false"
  (addCondition)="addCondition($event)"
  [templateMessageJson]="templateMessage.json"
/>
}
